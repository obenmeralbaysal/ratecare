<?php

namespace App\Http\Controllers;

use function GuzzleHttp\json_decode;
use App\Libraries\SabeeClient;
use App\Models\Widget;
use App\Models\Statistic;
use App\Models\Country;
use Carbon\Carbon;
use App\Models\Hotel;
use App\Models\Rate;
use PHPExcel;
use PHPExcel_IOFactory;
use App\User;
use Facebook\WebDriver\Chrome\ChromeOptions;
use Facebook\WebDriver\Remote\DesiredCapabilities;
use Facebook\WebDriver\Remote\RemoteWebDriver;
use Laravel\Dusk\Browser;
use Laravel\Dusk\Chrome\ChromeProcess;
use SapiStudio\SeleniumStealth\SeleniumStealth;

class TestController extends \App\Libraries\TestController
{
  // public function __construct()
  // {
  //     $this->middleware('auth:admin');
  // }

  function testProxy()
  {
    echo 'To enable your free eval account and get CUSTOMER, YOURZONE and ' .
      'YOURPASS, please contact sales@brightdata.com';
    $curl = curl_init('http://lumtest.com/myip.json');
    curl_setopt($curl, CURLOPT_PROXY, 'http://brd.superproxy.io:22225');
    curl_setopt(
      $curl,
      CURLOPT_PROXYUSERPWD,
      'brd-customer-hl_d5405055-zone-static:lhhfqibxtspi'
    );
    curl_exec($curl);
  }

  public function odamaxCurlTest()
  {
    // Generated by curl-to-PHP: http://incarnate.github.io/curl-to-php/
    $ch = curl_init();

    curl_setopt(
      $ch,
      CURLOPT_URL,
      'https://www.odamax.com/tr/hotel/hammamhane-279268?utm_source=kucukoteller&utm_medium=textad&check_in=17.06.2024&check_out=18.06.2024&adult_1=2&type=HOTEL&currency=EUR'
    );
    curl_setopt($ch, CURLOPT_PROXY, 'http://brd.superproxy.io:22225');
    curl_setopt(
      $ch,
      CURLOPT_PROXYUSERPWD,
      'brd-customer-hl_d5405055-zone-datacenter_proxy1:adyok54ytm8i'
    );
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_HEADER, 1);

    $result = curl_exec($ch);
    if (curl_errno($ch)) {
      echo 'Error:' . curl_error($ch);
    }
    $html = $result;

    $tryPrice = search('<i class="integers ">', '</i>', $html);

    dd($tryPrice);

    curl_close($ch);
  }

  public function iframeTest()
  {
    echo '
    <link rel="import" href="https://ibe.sabeeapp.com/properties/Fuda-Hotel-rezervasyon/?p=bSpa85053f45359624e">
';
  }

  public function testOdamaxPriceAgain()
  {
    $a = getOdamaxPrice(
      "https://www.odamax.com/tr/hotel/hammamhane-279268?utm_source=kucukoteller&utm_medium=textad",
      "EUR",
      "17.06.2024",
      "18.06.2024"
    );

    dd($a);
  }

  public function duskTest()
  {
    $process = (new ChromeProcess())->toProcess();
    $process->start();
    $options = (new ChromeOptions())->addArguments([
      '--disable-gpu',
      '--headless',
    ]);
    $capabilities = DesiredCapabilities::chrome()->setCapability(
      ChromeOptions::CAPABILITY,
      $options
    );
    $driver = retry(
      5,
      function () use ($capabilities) {
        return RemoteWebDriver::create('http://localhost:9515', $capabilities);
      },
      50
    );
    $browser = new Browser($driver);
    $html = $browser
      ->visit(
        'https://www.odamax.com/tr/hotel/hammamhane-279268?utm_source=kucukoteller&utm_medium=textad&check_in=17.06.2024&check_out=18.06.2024&adult_1=2&type=HOTEL&currency=EUR'
      )
      ->element('.hotel-detail')
      ->getDomProperty('innerHTML');

    dd($html);
    $browser->quit();
    $process->stop();
  }

  function curlTest()
  {
    // Generated @ codebeautify.org
    $ch = curl_init();

    curl_setopt($ch, CURLOPT_URL, 'https://tr.hotels.com/graphql');
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_ENCODING, 'gzip, deflate');

    $headers = [];
    $headers[] =
      'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/118.0';
    $headers[] = 'Accept: */*';
    $headers[] = 'Accept-Language: en-US,en;q=0.5';
    $headers[] = 'Accept-Encoding: gzip, deflate, br';
    $headers[] =
      'Referer: https://tr.hotels.com/ho637962624/labranda-mares-marmaris-all-inclusive-marmaris-turkiye/?beaconIssued=&bedroom_count_gt=&chain=&chkin=23.10.2023&chkout=26.10.2023&daysInFuture=&destType=MARKET&destination=Marmaris%2C%20Mu%C4%9Fla%2C%20T%C3%BCrkiye&endDate=26.10.2023&expediaPropertyId=19905082&group=&guestRating=&highlightedPropertyId=&hotelName=&latLong=36.854936%2C28.270878&misId=&neighborhood=&neighborhoodId=6329813&petsIncluded=false&poi=&position=2&pricing_group=&pwa_ts=1696666938970&rank=1&referrerUrl=aHR0cHM6Ly90ci5ob3RlbHMuY29tL0hvdGVsLVNlYXJjaA%3D%3D&regionId=6054843&rm1=a2&roomIndex=&searchId=5af9b77f-2046-4179-8b06-7232501bc639&selected=5959083&selectedRatePlan=211136263&selectedRoomType=202174894&slots=&sort=RECOMMENDED&startDate=23.10.2023&stayLength=&testVersionOverride=Buttercup%2C39483.0.0%2C47230.0.0%2C47232.155376.0%2C48676.154917.1%2C48304.0.0%2C50206.153476.0%2C50028.0.0%2C46969.152461.2%2C47890.143201.1%2C46458.0.0%2C47384.141794.1%2C47957.155318.1&theme=&trackingData=AAAAAQAAAAEAAAAQ3JdxVw_9D6_97RqJ579cu7lIZZtJqpWgSvn9dttNfdptfaQzq-IUE5iXDNAp5BOV62_1Z0EF4aQcnBGFu80sJo5qRtTr1EBnK3oYTZYzG1Swa_o44EMNzNpYhL4ggBy5rK4zqw32uctc7-GMHCBOPx8berZJw1QN_CNhGx5MM_XOtzeuFksEE39kN3NNAfVkhbCq_FpyZXntjJiYhHum7Acs-Rvu7zuxYd0sk-NnR1lTV3CweJORr789uZPyXbYVrnuKZuj3-4EWRocZ0pbL_YMAE7CuxCp5davil1ON2w7ZhzPBKWQbe-DB5ermQ4D8C1ifnUd3AJgiPup6-Rjk2WOg4Mc3Wygo0HqUtEvzunPm8ACZ9frWtPJY5XvDXFFLuKbO-VOayRWCB0G4Zb3dvYFgPTs9GOnESn-0YuZE0iYgJwAo3EOjw2QH9w-zhH85u-sGCS57KOIk2hAmXrU-Sak8VD37MhpDV8EyfRMR6ByW60PC8-c2e1P1LzW3qJscnseyLjmso6pWcAunleymxPzs1QwicbGnv-RWSbwDW_1X9pTXl3ggShf1pj8B3OIF2uSh0eZ50wRg1AxbhFJpo7eFlZGIEa0cMOTnY2hexPMJdsP2Dlf7W0OJxTLmZQIhoXu002UGnLvfFkEsWYGgn_JPGO47Zgx9sktu_O2P9yVz9JcJ1gOvYdv-U-vC9uHT6GJskZiYuZeQzKNQlI52jpvSXvA-f2fKgbz004FQgHgII6buAqxDQ_iHYTP_KgwGtmY3pSj32B-W3nnv0xB-X18PRxgor_w9_OdrMreY0H4Rp9lMYzymBHl3d0_NwGeeL3u3hbQpN2cuDGNoQLOYpLqqWsueNvpAkzSjYyuty4qgMHr252hR6CxyXH8tDxzcnOnDqMB9hF-Mluzbu155cEOGkqIE-b0BDIjnIPHzZzQs6frbu8gLKjpc8Z-FTDQfeRCSEJo2NsMTtfTgcnoQ8Cguytoio084XOhNlb2HUGT_JyK3NnJbq0rSPt1vXdqdVDncKY4uNuBTAYjMD3_7igsw7anYAilP0mf9TMVDvnlEN5LRPnMzduYQSB0kiu6edzMkIO2x3XEiOoJaCk_T5E4OjCbZ5ehldLLA0hBRkiiFuunqSe4tdCQRPkqfjUZgqvPci8dMH_M8RPngyq0s5vqWJB8S34BrcNvwkHFOALW-Ij9kVdCVieJ9aHFCy40PlFcrfX56HBx9lIHd2fhys96NA5UC81Y_vroJTHOgeS42LM87doCc8ejkfXKj4ot1fGtrgQZ8me08hs_e_YJEephi_30QenJWlitYocBX_nX-9_a13TlBMPBD5rVclVxx_EIx5BbE2DOwNUyiAon3mUp_EHPK-tdEBSCMsCVNJPo2DSEinLuCs83X7efcbBedjCPrKmK8d5IJ_Dl4R2J31GF0svPqDBKWsms9ctVgr5ID0it4DccO17oTV2chUt-qkMaJTGBkMdD4UFmWXXL5kRgaAxDhHDWoI02eoSAiT_CASW_YQHOoLVVaOscsLv7vBAcIwt2knd6e0xaP_r3e1nzxTedHksJfXlKw7NFA1_HIKkVEqgvX085cTUxcZj23lArRsQJWYWemv2g0yfqWmYdFoJBy1LTxf93qHyd2qeThlO0OOkfrNzSbUEKnoKgnVSXckcCzejzYwMgwntm0N3bvtJ0o3P1R3WmADh4aQmKtHN58ABu6D7qd6Z4o0eRxacLjULQxqFm3rUpOsssuHzkGY1FuTDZTKbZWYy6pJlklQ_ZZ1e9krbv8GzUBii4NIWNmuhFL7ZUr3yUXoPTxdtb8h6za62Q9jJJx-onuHSSB7IFPwe0rmC1PY49aIuVlcUwqwp40y3SRba4WpEfOp4Aj66s4BBAaMKEEcWj7Peo2m0SQTDjV5lQaJfIggnrTdpej3SPCllzp7RlEm4jGIcQRvO9QUACKkALc6aHznCyWyd92_8wF38XllRGFdmji&us_bathroom_count_gt=&useRewards=false&userIntent=&vacationRentalsOnly=false&x_pwa=1';
    $headers[] = 'Content-Type: application/json';
    $headers[] =
      'Client-Info: shopping-pwa,c984d1924c878c274cce691c5aad2d106b6896a6,us-west-2';
    $headers[] = 'X-Product-Line: lodging';
    $headers[] = 'X-Page-Id: page.Hotels.Infosite.Information,H,30';
    $headers[] = 'Origin: https://tr.hotels.com';
    $headers[] = 'Dnt: 1';
    $headers[] = 'Connection: keep-alive';
    $headers[] =
      'Cookie: linfo=v.4,|0|0|255|1|0||||||||1055|0|0||0|0|0|-1|-1; CRQSS=e|28; CRQS=t|3115`s|300000028`l|tr_TR`c|TRY; currency=TRY; iEAPID=28; tpid=v.1,3115; cesc=%7B%22lpe%22%3A%5B%22235662d3-c716-4772-913d-fc08b89bfd7f%22%2C1696666942717%5D%2C%22marketingClick%22%3A%5B%22false%22%2C1696666942717%5D%2C%22lmc%22%3A%5B%22SEO.U.GOOGLE.COM%22%2C1696666942717%5D%2C%22hitNumber%22%3A%5B%223%22%2C1696666942717%5D%2C%22amc%22%3A%5B%22SEO.U.GOOGLE.COM%22%2C1696666942717%5D%2C%22visitNumber%22%3A%5B%221%22%2C1696666924099%5D%2C%22ape%22%3A%5B%22235662d3-c716-4772-913d-fc08b89bfd7f%22%2C1696666942717%5D%2C%22cidVisit%22%3A%5B%22SEO.U.google.com%22%2C1696666942717%5D%2C%22entryPage%22%3A%5B%22noonewillmatchthis%22%2C1696666942717%5D%2C%22cid%22%3A%5B%22SEO.U.google.com%22%2C1696666924099%5D%7D; HMS=55f3d5d9-4ba5-4568-a4f4-4d5a084a20d3; MC1=GUID=0566b56e3e764ba8b011ec4d119ae11f; DUAID=0566b56e-3e76-4ba8-b011-ec4d119ae11f; akacd_pr_20=1701850924~rv=82~id=d05287819876175e1e852c7fd3d2d378; _abck=D450D6EEE906FF0B46909DE07B456507~0~YAAQhYYUAsVEQ/GKAQAAL7w6CQqhiwLy2bzyQO1xXSwsNEUmSNFhiIwAwL2sOmzgQGaKQd9IUgrYA7glmQZDHfpEOMA0TDuEm7nZM719gRgcBV0PMdTuAO4bDBB/8qRYhhLhV+f2BWsNClvvmYwyOVO8wgZ5JXdZ02YEdgA9H/KAHr1GWYBjBKRNXxMm5x9eUEutluytdA9BnP6utDyGqCtnYDrvIEGhaVAb3s8nMTGsi/j34W2/4OmIj+UuMv4qqIOktf1eX+RTm7tdwTLk/ZBMrJZrW1wVS8ACLEgOc6N28fv8fbo2hnUgUnyxz0lMWmGS6m66+ENpQ2nwor90aLXgFOABuqt3QlnY7Nc+Pdq3wcRK/+l16paRYWXai9zgA2TSCGRz3KHycT6mnKx3AFD3w0B5GvEjZA==~-1~-1~-1; bm_sz=17291D98D60C1246CF0ECA496D6D7A7F~YAAQhYYUAmJEQ/GKAQAAfbQ6CRUM8wZ6AxsjEKI7RDSeZxOodZ7yOxdWLwLJ6QKu9+im4X5CrFWY/T21LgOLZcH4AUxJxR93gD20PZn/qG/xNPSbFmv5CZ97yF2iEX4m0q+S2t7bXluFU0QN7wC6QT/+BT3dEq8YV6HM50UnnBIRcOGCA54wI+sDSzhoKdKO2qRfwqoh0dLwCnb3k1EuDwc6S0biZSWxZzKcfvAbPFjNF2lVzfWTPWRYKKvuLv9Q0jMBobJgRx7wtS8g02FqPAwyeX8vCPsPjHjaGeZBZ/athuQ=~3553602~3163698; AMCV_C00802BE5330A8350A490D4C%40AdobeOrg=1585540135%7CMCIDTS%7C19638%7CMCMID%7C19315910705856616108288333326683915075%7CMCAID%7CNONE%7CMCOPTOUT-1696674150s%7CNONE%7CvVersion%7C4.4.0; s_ppn=page.Hotels.Infosite.Information; s_ppv=%5B%5BB%5D%5D; s_ips=1; s_tp=6518; AMCVS_C00802BE5330A8350A490D4C%40AdobeOrg=1; s_cc=true; _dd_s=rum=0&expire=1696667978720; EG_SESSIONTOKEN=dFw8i2j8UeYyKPnbMQRcLafI2pHyXNHikBp374JGmnJ0Sc:HubOOb8-Im-Sr7Yt05-HAp2EWw4_gXLnu9AXrOVJQvEb5BJkbrt32pRRh8dshqrb93WXeHBYS21o8dyW6giVew; session_id=55f3d5d9-4ba5-4568-a4f4-4d5a084a20d3; page_name=page.Hotel-Search';
    $headers[] = 'Sec-Fetch-Dest: empty';
    $headers[] = 'Sec-Fetch-Mode: cors';
    $headers[] = 'Sec-Fetch-Site: same-origin';
    $headers[] = 'Sec-Gpc: 1';
    $headers[] = 'Te: trailers';
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);

    $result = curl_exec($ch);
    if (curl_errno($ch)) {
      echo 'Error:' . curl_error($ch);
    }
    curl_close($ch);

    dd($result);
  }

  function otelzTestUrl()
  {
    $otelzPrice = getOtelZPrice("5067", "TRY", "2024-01-17", "2024-01-19");
    $otelzUrl = getOtelzUrl("5067", "TRY", "2024-01-17", "2024-01-19");

    dd($otelzUrl);
  }

  function replaceOtelzUrls()
  {
    $hotels = Hotel::all();
    $c = 0;
    foreach ($hotels as $hotel) {
      $otelzUrl = $hotel->otelz_url;
      if ($otelzUrl) {
        if (str_contains($otelzUrl, "room-prices/")) {
          $facilityID = str_after($otelzUrl, "room-prices/");

          if (str_contains($facilityID, "/")) {
            $facilityID = str_replace("/", "", $facilityID);
          }

          if ($facilityID != "") {
            dump($facilityID);
          }
          $c++;

          $hotel->otelz_url = $facilityID;
          $hotel->save();
        }
      }
    }
    dd($c);
  }

  function sabeeTest()
  {
    getSabeeRoomsPrice(5304, "TRY", "2024-02-26", "2024-02-27");
  }

  function getETSTurPrice()
  {
    $postData = [
      "hotelId" => "ASIDAT",
      "checkIn" => "2022-03-15",
      "checkOut" => "2022-03-16",
      "adults" => 2,
      "currency" => "TRY",
    ];
    $postData = json_encode($postData);

    $ch = curl_init('https://mapi.etstur.com/api/kucukoteller/availability');
    curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_POSTFIELDS, $postData);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    $response = json_decode(curl_exec($ch));
    $data = ['price' => $response->totalRate, 'url' => $response->deeplink];
    dd($data);
  }

  public function importTheSmallHotels()
  {
    ini_set('max_execution_time', 0);

    $inputFileName = './thesmallhotels1.xls';

    try {
      $inputFileType = PHPExcel_IOFactory::identify($inputFileName);
      $objReader = PHPExcel_IOFactory::createReader($inputFileType);
      $objPHPExcel = $objReader->load($inputFileName);
    } catch (Exception $e) {
      die(
        'Error loading file "' .
          pathinfo($inputFileName, PATHINFO_BASENAME) .
          '": ' .
          $e->getMessage()
      );
    }

    $sheet = $objPHPExcel->getSheet(2);
    $highestRow = $sheet->getHighestRow();
    $highestColumn = $sheet->getHighestColumn();

    for ($row = 2; $row <= $highestRow; $row++) {
      //  Read a row of data into an array
      $rowData = $sheet->rangeToArray(
        'A' . $row . ':' . $highestColumn . $row,
        null,
        true,
        false
      );

      if ($rowData[0][0] == null) {
        continue;
      }

      $name = $rowData[0][0];
      $email = $rowData[0][1];
      $bookingurl = $rowData[0][2];

      $user = User()
        ::where("reseller_id", "=", 1233)
        ->where("namesurname", $name)
        ->first();

      //            dd(substr($bookingurl, 0, strpos($bookingurl, '.html')));

      if ($user) {
        $hotel = $user->hotels()->first();
      }

      if ($hotel) {
        if ($bookingurl) {
          $hotel->booking_url =
            substr($bookingurl, 0, strpos($bookingurl, '.html')) . ".tr.html";
          $hotel->booking_is_active = 1;
          $hotel->save();
        }
      } else {
        $user = new User();

        $user->namesurname = $name;
        $user->email = $email;
        $user->password = bcrypt("kucukoteller1234");
        $user->user_type = 0;
        $user->reseller_id = 1233;

        $user->save();

        $hotel = new Hotel();

        $hotel->user_id = $user->id;
        $hotel->name = $name;
        $hotel->booking_url =
          substr($bookingurl, 0, strpos($bookingurl, '.html')) . ".tr.html";
        $hotel->booking_is_active = 1;

        $hotel->save();

        $main_tr_widget = $hotel
          ->widgets()
          ->where("language_id", 1)
          ->where("type", "main")
          ->first();
        $main_en_widget = $hotel
          ->widgets()
          ->where("language_id", 2)
          ->where("type", "main")
          ->first();
        $exit_tr_widget = $hotel
          ->widgets()
          ->where("language_id", 1)
          ->where("type", "exit")
          ->first();
        $exit_en_widget = $hotel
          ->widgets()
          ->where("language_id", 2)
          ->where("type", "exit")
          ->first();

        $code = generateWidgetCode();

        if ($main_tr_widget == null) {
          $main_tr_widget = new Widget();
          $main_tr_widget->language_id = 1;
          $main_tr_widget->type = "main";
          $main_tr_widget->code = $code;

          $main_tr_widget->duration = 5;
          $main_tr_widget->is_active = 1;
          $main_tr_widget->main_title =
            "En İyi Fiyat Garantisi. Güvenli Online Rezervasyon!";
          $main_tr_widget->reservation_button_text = "REZERVASYON";
          $main_tr_widget->direct_reservation_text = "En İyi Fiyat için Tıkla:";
          $main_tr_widget->features_text =
            "<ul><li>En İyi Fiyat Garantisi</li><li>Güvenli Online Rezervasyon</li><li>Ücretsiz Kahvaltı ve Wi-Fi</li></ul>";
          $main_tr_widget->color = "#740202";
          $main_tr_widget->discount = 5;
          $main_tr_widget->discount_type = 1;
          $main_tr_widget->currency_id = 2;

          $hotel->widgets()->save($main_tr_widget);
        }

        if ($main_en_widget == null) {
          $main_en_widget = new Widget();
          $main_en_widget->language_id = 1;
          $main_en_widget->type = "main";
          $main_en_widget->code = $code;

          $main_en_widget->duration = 5;
          $main_en_widget->is_active = 1;
          $main_en_widget->main_title =
            "Best Rate Guaranteed. Don't Miss the Opportunity!";
          $main_en_widget->reservation_button_text = "RESERVATION";
          $main_en_widget->direct_reservation_text = "Book Now for";
          $main_en_widget->features_text =
            "<ul><li>Best Rate Guaranteed</li><li>Free Breakfast</li><li>Free Wifi</li></ul>";
          $main_en_widget->color = "#740202";
          $main_en_widget->discount = 5;
          $main_en_widget->discount_type = 1;
          $main_en_widget->currency_id = 2;

          $hotel->widgets()->save($main_en_widget);
        }

        if ($exit_tr_widget == null) {
          $exit_tr_widget = new Widget();
          $exit_tr_widget->language_id = 1;
          $exit_tr_widget->type = "exit";
          $exit_tr_widget->code = $code;

          $exit_tr_widget->is_active = 1;
          $exit_tr_widget->main_title =
            "Sitemizden Ayrılmak İstediğinize Emin Misiniz?";
          $exit_tr_widget->explanation_text =
            "Web sitemiz üzerinden yapacağınız güvenli online rezervasyon ile her zaman en iyi fiyat garantisini yakalayacağınızı hatırlatmak isteriz. Sizi aramızda görmek adına yapacağınız tüm rezervasyonlarda geçerli olmak üzere %5 değerindeki indirim kuponuna ait bilgileri aşağıda bulabilirsiniz. Sadece www.fudaotel.com.tr sitemiz üzerinden yapılacak online rezervasyonlar için geçerlidir.";
          $exit_tr_widget->features_text =
            "<ul><li>En İyi Fiyat ile Rezervasyon</li><li>Zamandan Tasarruf</li></ul>";
          $exit_tr_widget->reservation_button_text = "REZERVE ET";
          $exit_tr_widget->promotion_text = "İndirim Kodunuz";
          $exit_tr_widget->promotion_code = "LOVEISTANBUL";
          $exit_tr_widget->color = "#740202";

          $hotel->widgets()->save($exit_tr_widget);
        }

        if ($exit_en_widget == null) {
          $exit_en_widget = new Widget();
          $exit_en_widget->language_id = 2;
          $exit_en_widget->type = "exit";
          $exit_en_widget->code = $code;

          $exit_en_widget->is_active = 1;
          $exit_en_widget->main_title = "Hey, Don't Leave!";
          $exit_en_widget->explanation_text =
            "We have a special offer for you. Please use the below discount code to get your special rate for your accommodation in Istanbul. Only available for bookings made on our official website.";
          $exit_en_widget->features_text =
            "<ul><li>Best Rate Guaranteed</li><li>Free Breakfast</li><li>Free Wifi</li></ul>";
          $exit_en_widget->reservation_button_text = "Book Now";
          $exit_en_widget->promotion_text = "Discount Code";
          $exit_en_widget->promotion_code = "LOVEISTANBUL";
          $exit_en_widget->color = "#740202";

          $hotel->widgets()->save($exit_en_widget);
        }
      }
    }

    dd("Complete");
  }

  public function testOtelzProblem()
  {
    $facilityID = "6463";

    $data = [
      "api_version" => "1.0.0",
      "partner_id" => 1316,
      "facility_reference" => 6463,
      "start_date" => "2021-10-25",
      "end_date" => "2021-10-26",
      "party" => [
        [
          "adults" => 2,
          "children" => [],
        ],
      ],

      "lang" => "tr",
      "currency" => "TRY",
      "price_formatter" => [
        "decimal_digit_number" => 2,
      ],
      "user_country" => "TR",
      "device_type" => 1,
      "request_type" => 1,
      "web_hook_url" => "",
    ];

    $json = json_encode($data);

    $username = "kucukoteller";
    $passwd = "4;q)Dx9#";

    $headers = [
      'Content-Type:application/json',
      'Authorization: Basic ' . base64_encode("$username:$passwd"),
    ];

    $ch = curl_init('https://fullconnect.otelz.com/detail/availability');

    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_POSTFIELDS, $json);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);

    $result = json_decode(curl_exec($ch));

    dd($result);
  }

  public function testHotelRunner()
  {
    $url =
      'https://the-halich-hotel-istanbul-karakoy.hotelrunner.com/api/v1/bv3/search/prices.json?ids[]=402807&ids[]=402808&ids[]=403359&ids[]=403360&ids[]=403361&ids[]=402809&ids[]=402810&ids[]=403362&ids[]=403363&ids[]=403364&ids[]=402811&ids[]=402812&ids[]=403365&ids[]=403366&ids[]=403367';

    $queryArray = [
      'api_key' => '7518391247a27ce412d421ffe241c6ffd3f52e7c4b26e993',
      'checkin_date' => '2021-10-21',
      'checkout_date' => '2021-10-22',
      'guest_rooms' => [
        [
          'adult_count' => '2',
          'guest_count' => '2',
          'child_count' => '0',
        ],
      ],
      'currency' => 'TRY',
      'locale' => 'en-US',
      'c_code' => null,
    ];

    $baseUrl = parse_url($url)['host'];
    dd(parse_url($url)['query']);

    $headers = [
      'Accept: application/json, text/plain, */*',
      'Accept-Encoding: gzip, deflate, br',
      'Accept-Language: en-US,en;q=0.5',
      'Connection: keep-alive',
      'Cookie: locale=en-US; currency=BAhJIghFVVIGOgZFVA%3D%3D==--ee0da01ef7ac09e00574b2107efb3ff1079fad4e; loccur=TRY; country_code=BAhJIgdUUgY6BkVU--4b046995e58c082ff009e67f439c797f7188bfc7; checkout_currency=BAhJIghFVVIGOgZFVA%3D%3D==--ee0da01ef7ac09e00574b2107efb3ff1079fad4e',
      'DNT: 1',
      'Host: the-halich-hotel-istanbul-karakoy.hotelrunner.com',
      'Referer: https://the-halich-hotel-istanbul-karakoy.hotelrunner.com/bv3/search',
      'Sec-Fetch-Dest: empty',
      'Sec-Fetch-Mode: cors',
      'Sec-Fetch-Site: same-origin',
      'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:92.0) Gecko/20100101 Firefox/92.0',
    ];

    dump($url . "&" . urldecode(http_build_query($queryArray)));

    $ch = curl_init($url . "&" . urldecode(http_build_query($queryArray)));

    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "GET");
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);

    $result = json_decode(curl_exec($ch));

    $prices = [];
    foreach ($result->prices as $priceStack) {
      foreach ($priceStack as $room) {
        array_push($prices, $room->nr_price);
      }
    }
    dd(min($prices));
  }

  public function sabeeRoomsTest()
  {
    $rooms = getSabeeRooms(7045);
    foreach ($rooms as $room) {
      dump($room->room_id);
    }
    dd($rooms);
  }

  public function getReselivaPrice()
  {
    $username = "uKucukOteller";
    $passwd = "138Rs!5g8SD";

    //        $headers = [
    //            'Authorization: Basic ' . base64_encode("$username:$passwd")
    //        ];
    //
    //
    //        $ch = curl_init('https://www.reseliva.com/siteBase/REST/kucukotellercomtr/service/hotel_inventory?api_version=1&lang=tr_TR');
    //
    //        curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "GET");
    //        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    //        curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
    //        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
    //
    //
    //        $result = json_decode(curl_exec($ch));
    //
    //        dump($result);

    $data = [
      'api_version' => 1,
      'start_date' => "2021-04-13",
      'end_date' => "2021-04-14",
      'hotels' => '[{"ta_id":1,"partner_id":"7813"}]',
      'currency' => "USD",
      'user_country' => "TR",
      'device_type' => "d",
      'party' => '[{"adults":2, "children":[]}]',
      'source' => "kucukotellercomtr",
    ];

    $postData = http_build_query($data);

    $headers2 = [
      'Content-Type: application/x-www-form-urlencoded',
      'Authorization: Basic ' . base64_encode("$username:$passwd"),
    ];

    $ch2 = curl_init(
      'https://www.reseliva.com/siteBase/REST/kucukotellercomtr/service/hotel_availability'
    );

    curl_setopt($ch2, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch2, CURLOPT_POSTFIELDS, $postData);
    curl_setopt($ch2, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch2, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
    curl_setopt($ch2, CURLOPT_HTTPHEADER, $headers2);

    dd(json_decode(curl_exec($ch2)));
  }

  public function otelzApiSearch()
  {
    $data = [
      "api_version" => "1.0.0",
      "partner_id" => -200,
      "filter" => [
        "facility_references" => [15627],
        "type" => "HotelIdList",
      ],
      "start_date" => "2021-07-25",
      "end_date" => "2021-07-26",
      "party" => [
        [
          "adults" => 2,
          "children" => [],
        ],
      ],
      "lang" => "tr",
      "currency" => "TRY",
      "price_formatter" => [
        "decimal_digit_number" => 2,
      ],
      "user_country" => "TR",
      "page_number" => 1,
      "page_size" => 1,
    ];

    $json = json_encode($data);

    $headers = [
      'Content-Type:application/json',
      'Authorization: Basic ' . base64_encode("GlobalTest1:GlobalTest1"), // <---
    ];

    $ch = curl_init(
      'https://fullconnect-api.k8s.otelz.com/search/availability'
    );

    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_POSTFIELDS, $json);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
    curl_setopt($ch, CURLOPT_USERPWD, "GlobalTest1:GlobalTest1");
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);

    $result = json_decode(curl_exec($ch));

    dd($result->availability->search_items[0]->link);
  }

  public function otelzApi()
  {
    $data = [
      "api_version" => "1.0.0",
      "partner_id" => 1316,
      "facility_reference" => 15627,
      "start_date" => "2021-07-21",
      "end_date" => "2021-07-22",
      "party" => [
        [
          "adults" => 2,
          "children" => [],
        ],
      ],

      "lang" => "tr",
      "currency" => "TRY",
      "price_formatter" => [
        "decimal_digit_number" => 2,
      ],
      "user_country" => "TR",
      "device_type" => 1,
      "request_type" => 1,
      "web_hook_url" => "",
    ];

    $json = json_encode($data);

    $username = "kucukoteller";
    $passwd = "4;q)Dx9#";

    $headers = [
      'Content-Type:application/json',
      'Authorization: Basic ' . base64_encode("$username:$passwd"),
    ];

    $ch = curl_init('https://fullconnect.otelz.com/detail/availability');

    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_POSTFIELDS, $json);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);

    $result = json_decode(curl_exec($ch));
    $price = $result->detail_result;

    dd($price);
  }

  public function getPHPInfo()
  {
    phpinfo();
  }

  public function otelzAlachiTest()
  {
    getOtelZPrice(13369, "TRY", "2021-05-03", "2021-05-04");
  }

  public function kucukotellerWidgets()
  {
    $k = User::findOrFail(55)
      ->subUsers()
      ->with("hotels")
      ->get();

    //        foreach ($k as $u){
    //            $w = $u->hotels()->get();
    //            foreach($w as $h){
    //                $z = $h->widgets()->get();
    //                    foreach($z as $i){
    //                        $i->features_text = '<ul><li>En İyi Fiyat ile Rezervasyon</li><li>Zamandan Tasarruf</li></ul>';
    //                        $i->language_id = 1;
    //                        $i->currency_id = 2;
    //
    //                        $i->save();
    //
    //                        dump("Done !");
    //                    }
    //            }
    //        }
  }

  public function testFixedWidget()
  {
    echo '<script>var mainWidget = true; var exitWidget = true;</script><script src="https://hoteldigilab.biz/fixedWidget/7ybn2xmnwac"></script>';
  }

  public function testBooking()
  {
    dd(
      getBookingPrice(
        "https://www.booking.com/hotel/tr/suna-sun-boutique.tr.html",
        "TRY",
        "2020-10-27",
        "2020-10-28"
      )
    );
  }

  public function testOdamax()
  {
    dd(
      getOdamaxPrice(
        "https://www.odamax.com/tr/hotel/dias-hotel-136526",
        "TRY",
        "27.10.2020",
        "28.10.2020"
      )
    );
  }

  public function excel()
  {
    $excel = new PHPExcel();
    $excel->setActiveSheetIndex(0);

    $excel
      ->getActiveSheet()
      ->getStyle('A1:AB1')
      ->getFont()
      ->setBold(true);

    $excel
      ->getActiveSheet()
      ->getColumnDimension('A')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('B')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('C')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('D')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('E')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('F')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('G')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('I')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('J')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('K')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('L')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('M')
      ->setWidth(30);

    $excel->getActiveSheet()->SetCellValue('A1', "İsim");
    $excel->getActiveSheet()->SetCellValue('B1', "Email");
    $excel->getActiveSheet()->SetCellValue('C1', "Tür");
    $excel->getActiveSheet()->SetCellValue('D1', "OtelZ");

    $rowNum = 2;

    $excel->getActiveSheet()->SetCellValue('A' . $rowNum, "asdasd");
    $excel->getActiveSheet()->SetCellValue('B' . $rowNum, "asdasdasd");
    $excel->getActiveSheet()->SetCellValue('C' . $rowNum, "asdasdasd");
    $excel->getActiveSheet()->SetCellValue('D' . $rowNum, "asdasdasd");
    $rowNum++;

    // Do your stuff here

    //        dd($excel);

    // We'll be outputting an excel file
    header('Content-type: application/vnd.ms-excel');

    header(
      'Content-Disposition: attachment; filename="basinodam-global-suppressions.xls"'
    );

    $objWriter = $objWriter = PHPExcel_IOFactory::createWriter(
      $excel,
      'Excel2007'
    );
    ob_end_clean();
    $objWriter->save('php://output');
  }

  public function exportExcel()
  {
    $excel = new PHPExcel();
    $excel->setActiveSheetIndex(0);

    $excel
      ->getActiveSheet()
      ->getStyle('A1:AB1')
      ->getFont()
      ->setBold(true);

    $excel
      ->getActiveSheet()
      ->getColumnDimension('A')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('B')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('C')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('D')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('E')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('F')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('G')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('H')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('I')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('J')
      ->setWidth(30);
    $excel
      ->getActiveSheet()
      ->getColumnDimension('K')
      ->setWidth(30);

    $excel->getActiveSheet()->SetCellValue('A1', "Name");
    $excel->getActiveSheet()->SetCellValue('B1', "Sabee URL");
    $excel->getActiveSheet()->SetCellValue('C1', "Sabee Hotel ID");
    $excel->getActiveSheet()->SetCellValue('D1', "Booking URL");
    $excel->getActiveSheet()->SetCellValue('E1', "Hotels URL");
    $excel->getActiveSheet()->SetCellValue('F1', "Odamax URL");
    $excel->getActiveSheet()->SetCellValue('G1', "Otelz URL");
    $excel->getActiveSheet()->SetCellValue('H1', "Tatilsepeti URL");
    $excel->getActiveSheet()->SetCellValue('I1', "Reseliva Hotel ID");
    $excel->getActiveSheet()->SetCellValue('J1', "Hotelrunner URL");
    $excel->getActiveSheet()->SetCellValue('K1', "Etstur Hotel ID");

    $rowNum = 2;

    $users = user()
      ->subUsers()
      ->get();
    foreach ($users as $u) {
      $hotels = $u->hotels()->get();
      foreach ($hotels as $h) {
        $excel->getActiveSheet()->SetCellValue('A' . $rowNum, $h->name);
        $excel->getActiveSheet()->SetCellValue('B' . $rowNum, $h->sabee_url);
        $excel
          ->getActiveSheet()
          ->SetCellValue('C' . $rowNum, $h->sabee_hotel_id);
        $excel->getActiveSheet()->SetCellValue('D' . $rowNum, $h->booking_url);
        $excel->getActiveSheet()->SetCellValue('E' . $rowNum, $h->hotels_url);
        $excel->getActiveSheet()->SetCellValue('F' . $rowNum, $h->odamax_url);
        $excel->getActiveSheet()->SetCellValue('G' . $rowNum, $h->otelz_url);
        $excel
          ->getActiveSheet()
          ->SetCellValue('H' . $rowNum, $h->tatilsepeti_url);
        $excel
          ->getActiveSheet()
          ->SetCellValue('I' . $rowNum, $h->reseliva_hotel_id);
        $excel
          ->getActiveSheet()
          ->SetCellValue('J' . $rowNum, $h->hotelrunner_url);
        $excel
          ->getActiveSheet()
          ->SetCellValue('K' . $rowNum, $h->etstur_hotel_id);
        $rowNum++;
      }
    }

    // We'll be outputting an excel file
    header('Content-type: application/vnd.ms-excel');

    header('Content-Disposition: attachment; filename="hotels.xls"');

    $objWriter = $objWriter = PHPExcel_IOFactory::createWriter(
      $excel,
      'Excel2007'
    );
    ob_end_clean();
    $objWriter->save('php://output');
  }

  public function testHotels()
  {
    $url =
      "https://tr.hotels.com/ho185862/hotel-sari-konak-istanbul-turkiye/?chkin=2023-06-08&chkout=2023-06-09&x_pwa=1&rfrr=HSR&pwa_ts=1685807491842&referrerUrl=aHR0cHM6Ly90ci5ob3RlbHMuY29tL0hvdGVsLVNlYXJjaA%3D%3D&useRewards=false&rm1=a2&regionId=178267&destination=%C4%B0stanbul+%28ve+civar%C4%B1%29%2C+Istanbul%2C+T%C3%BCrkiye&destType=MARKET&neighborhoodId=6063107&selected=447256&latLong=41.007884%2C28.977964&sort=RECOMMENDED&top_dp=2259&top_cur=TRY&userIntent=&selectedRoomType=200088195&selectedRatePlan=202971762&expediaPropertyId=447256";
    $pathInfo = parse_url($url);
    $queryString = $pathInfo["query"];
    parse_str($queryString, $queryArray);

    $curl = curl_init($url);
    curl_setopt($curl, CURLOPT_URL, $url);
    curl_setopt($curl, CURLOPT_POST, 0);
    curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);

    $headers = [
      "User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:96.0) Gecko/20100101 Firefox/96.0",
      "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8",
      "Accept-Language: en-US,en;q=0.5",
      "Accept-Encoding: gzip, deflate, br",
      "DNT: 1",
      "Connection: keep-alive",
      "Cookie: _abck=267C24ADF1450413667920AF3A57D943~0~YAAQJ986F8bR6vh+AQAAFe0bAwe3N0EA4yqJNt5PdmGUQW/BeOsU/zlKemiaBYDTlwTMvwZyETmhq56SmzUDLosl87SC4kxxWkPWxemQbLwwPFmAoCF6fYYDmXyl40laTNDB7JNtrtvTtHn3i6iT6AkPVWVW3LnMsovnEGjZ+ShcOtBDHRoy7zRyvB1frCxjjt79VLhAN2/KKUiRJgtownZYMyH+Jrwat23IfV3Ba0TfHTe2BYJCZxEjEazxPtYMqOct9cGmFeSt/nnweTKArgK1MPNfBecWAsYDbfs93hesakERFBzX9UlXQXCW8UbhXC0BljDmElhfdmuAUwfY3FMPM69KwvUcuBnqQbHnes4esgkXffDhQVnYnV0obcj6xvKDBSJc4dYgttF3y+MpauOKF6fOuruEEQ==~-1~-1~-1; bm_sz=1189BDD1C906351B6356DA91F0B6EAB5~YAAQTt86F2no2/l+AQAA4qP0Aw60kWVBi8/3CGwihqAkOAneMBmxE8Bzr4bI2A6HowJxRQaTN+k3dupmw7ElXABTuc1lzykyFgR5dXd6LCbXzmhPltIaGImsdhUmwqPoMWBDWAkvs7YbH0ZNhxgSZXHl8suPeRBDTb8fW1y/804AYUYWTLZYd/s/EFJa6kYd77d8IbMmrWah1lrYkLaL/vEeuYOtwrhno3bJM+8ghDardJae2JkATBwpPU/tBlSLxg2DMui6xLfwqWcu82oQ9zoZP+IvzcLt+LYc2tJJ2G+nZ7mE0rGlOIxDZxyC/MCvaO0+v5YtU2Djc6w=~3687493~4337972; asc=1; SESSID=40p4ckIOcyIoXDY3x-ksJ_qaTc.pda-54d5459c96-g92cs; user=QSp0cl9UUnxIQ09NX1RS; guid=6b4f87a3-9225-4558-81d0-1ca727d3a9af; cesc=%7B%22marketingClick%22%3A%5B%22false%22%2C1645027864303%5D%2C%22hitNumber%22%3A%5B%221%22%2C1645027864303%5D%2C%22visitNumber%22%3A%5B%222%22%2C1645027864303%5D%2C%22entryPage%22%3A%5B%22kesapp%22%2C1645027864303%5D%7D; MC1=GUID=6b4f87a39225455881d01ca727d3a9af; DUAID=6b4f87a3-9225-4558-81d0-1ca727d3a9af; h_darq=f; mvthistory=eJxFjzuOA0EIRG%2FUguLbpE42WVmynDv2HXx4zwxIzl4%2Fqkuwc8mi9QYKTotP1tJtCycyV0oeRMXk2XMUJ6xlBncyirf6JSG6B1Kmp2A%2B0vbEXLQL%2BXhE27NdENEDKyXClVZmGzDt0mNPdhkZs7yUgqglNBpM8Dst%2B4vBr%2BbP3%2B3%2B%2F3o%2BvuBsN%2FA%3D; dr=CCC~1645024632~4AC53E13F550519C87C3091FE7572AB940C08070DD62F3D81B9892B4F8A01B40; akacd_pr_20=1650208634~rv=6~id=f8e2e37a6fa6c823e462e0035aacb634; AMCV_C00802BE5330A8350A490D4C%40AdobeOrg=-1330315163%7CMCIDTS%7C19040%7CMCMID%7C03656398935412921058037564888131622516%7CMCAID%7CNONE%7CMCOPTOUT-1645031872s%7CNONE; Session_Pageviews=6; homepage_search_data=xLBzdGFuYnVsLCBJc3RhbmJ1bCwgVMO8cmtpeWU.%2F%2F16%2F02%2F2022%2F%2F17%2F02%2F2022%2F%2F2%2F%2Fdd%2FMM%2Fyyyy%2F%2F1341107%2F%2F; AMCVS_C00802BE5330A8350A490D4C%40AdobeOrg=1; s_sq=%5B%5BB%5D%5D; s_cc=true; AFFLB=A; visitId=b6b96dfd-69aa-4534-9c99-5642f89fc693; HMS=782dc68d-14eb-455b-94a7-2057ab01a7c1",
      "Upgrade-Insecure-Requests: 1",
      "Sec-Fetch-Dest: document",
      "Sec-Fetch-Mode: navigate",
      "Sec-Fetch-Site: same-origin",
    ];
    curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);
    curl_setopt($curl, CURLOPT_ENCODING, "gzip");

    $html = curl_exec($curl);

    $price = search('top_dp=', '&top_cur=', $html);
    dd($price);
  }

  public function importExcel()
  {
    ini_set('max_execution_time', 0);

    $inputFileName = './thesmallhotels1.xls';

    try {
      $inputFileType = PHPExcel_IOFactory::identify($inputFileName);
      $objReader = PHPExcel_IOFactory::createReader($inputFileType);
      $objPHPExcel = $objReader->load($inputFileName);
    } catch (Exception $e) {
      die(
        'Error loading file "' .
          pathinfo($inputFileName, PATHINFO_BASENAME) .
          '": ' .
          $e->getMessage()
      );
    }

    $sheet = $objPHPExcel->getSheet(2);
    $highestRow = $sheet->getHighestRow();
    $highestColumn = $sheet->getHighestColumn();

    $excel = new PHPExcel();
    $excel->setActiveSheetIndex(0);

    //        $excel->getActiveSheet()->getStyle('A1:AB1')->getFont()->setBold(true);

    //        $excel->getActiveSheet()->getColumnDimension('A')->setWidth(30);
    //        $excel->getActiveSheet()->getColumnDimension('B')->setWidth(30);
    //        $excel->getActiveSheet()->getColumnDimension('C')->setWidth(30);
    //        $excel->getActiveSheet()->getColumnDimension('D')->setWidth(30);
    //        $excel->getActiveSheet()->getColumnDimension('E')->setWidth(30);
    //        $excel->getActiveSheet()->getColumnDimension('F')->setWidth(30);
    //        $excel->getActiveSheet()->getColumnDimension('G')->setWidth(30);
    //        $excel->getActiveSheet()->getColumnDimension('H')->setWidth(30);
    //        $excel->getActiveSheet()->getColumnDimension('I')->setWidth(30);
    //
    //        $excel->getActiveSheet()->SetCellValue('A1', "Name Surname");
    //        $excel->getActiveSheet()->SetCellValue('B1', "Email");
    //        $excel->getActiveSheet()->SetCellValue('C1', "Website URL");
    //        $excel->getActiveSheet()->SetCellValue('D1', "Password");
    //        $excel->getActiveSheet()->SetCellValue('E1', "Property Name");
    //        $excel->getActiveSheet()->SetCellValue('F1', "Odamax Url");
    //        $excel->getActiveSheet()->SetCellValue('G1', "OtelZ Url");
    //        $excel->getActiveSheet()->SetCellValue('H1', "IBE Url");
    //        $excel->getActiveSheet()->SetCellValue('I1', "Widget Code");

    $count = 2;
    for ($row = 2; $row <= $highestRow; $row++) {
      //  Read a row of data into an array
      $rowData = $sheet->rangeToArray(
        'A' . $row . ':' . $highestColumn . $row,
        null,
        true,
        false
      );

      if ($rowData[0][0] == null) {
        continue;
      }

      $name = $rowData[0][0];
      $email = $rowData[0][1];
      $bookingurl = $rowData[0][2];

      dd($bookingurl);

      $isEmailExists = User::all()
        ->where("email", $email)
        ->first();

      if ($isEmailExists) {
        $email = "widget" . $row . "@kucukoteller.com.tr";
      }

      if ($email == null) {
        $email = "widget" . $row . "@kucukoteller.com.tr";
      }

      $user = new User();

      $user->namesurname = $name;
      $user->email = $email;
      $user->password = bcrypt("kucukoteller1234");
      $user->user_type = 0;
      $user->reseller_id = 55;

      $user->save();

      $hotel = new Hotel();

      $hotel->user_id = $user->id;
      $hotel->name = $name;
      $hotel->booking_url = $bookingurl;
      $hotel->booking_is_active = 0;

      $hotel->save();

      $main_tr_widget = $hotel
        ->widgets()
        ->where("language_id", 1)
        ->where("type", "main")
        ->first();
      $main_en_widget = $hotel
        ->widgets()
        ->where("language_id", 2)
        ->where("type", "main")
        ->first();
      $exit_tr_widget = $hotel
        ->widgets()
        ->where("language_id", 1)
        ->where("type", "exit")
        ->first();
      $exit_en_widget = $hotel
        ->widgets()
        ->where("language_id", 2)
        ->where("type", "exit")
        ->first();

      $code = generateWidgetCode();

      if ($main_tr_widget == null) {
        $main_tr_widget = new Widget();
        $main_tr_widget->language_id = 1;
        $main_tr_widget->type = "main";
        $main_tr_widget->code = $code;

        $main_tr_widget->duration = 5;
        $main_tr_widget->is_active = 1;
        $main_tr_widget->main_title =
          "En İyi Fiyat Garantisi. Güvenli Online Rezervasyon!";
        $main_tr_widget->reservation_button_text = "REZERVASYON";
        $main_tr_widget->direct_reservation_text = "En İyi Fiyat için Tıkla:";
        $main_tr_widget->features_text =
          "<ul><li>En İyi Fiyat Garantisi</li><li>Güvenli Online Rezervasyon</li><li>Ücretsiz Kahvaltı ve Wi-Fi</li></ul>";
        $main_tr_widget->color = "#740202";
        $main_tr_widget->discount = 5;
        $main_tr_widget->discount_type = 1;
        $main_tr_widget->currency_id = 2;

        $hotel->widgets()->save($main_tr_widget);
      }

      if ($main_en_widget == null) {
        $main_en_widget = new Widget();
        $main_en_widget->language_id = 1;
        $main_en_widget->type = "main";
        $main_en_widget->code = $code;

        $main_en_widget->duration = 5;
        $main_en_widget->is_active = 1;
        $main_en_widget->main_title =
          "Best Rate Guaranteed. Don't Miss the Opportunity!";
        $main_en_widget->reservation_button_text = "RESERVATION";
        $main_en_widget->direct_reservation_text = "Book Now for";
        $main_en_widget->features_text =
          "<ul><li>Best Rate Guaranteed</li><li>Free Breakfast</li><li>Free Wifi</li></ul>";
        $main_en_widget->color = "#740202";
        $main_en_widget->discount = 5;
        $main_en_widget->discount_type = 1;
        $main_en_widget->currency_id = 2;

        $hotel->widgets()->save($main_en_widget);
      }

      if ($exit_tr_widget == null) {
        $exit_tr_widget = new Widget();
        $exit_tr_widget->language_id = 1;
        $exit_tr_widget->type = "exit";
        $exit_tr_widget->code = $code;

        $exit_tr_widget->is_active = 1;
        $exit_tr_widget->main_title =
          "Sitemizden Ayrılmak İstediğinize Emin Misiniz?";
        $exit_tr_widget->explanation_text =
          "Web sitemiz üzerinden yapacağınız güvenli online rezervasyon ile her zaman en iyi fiyat garantisini yakalayacağınızı hatırlatmak isteriz. Sizi aramızda görmek adına yapacağınız tüm rezervasyonlarda geçerli olmak üzere %5 değerindeki indirim kuponuna ait bilgileri aşağıda bulabilirsiniz. Sadece www.fudaotel.com.tr sitemiz üzerinden yapılacak online rezervasyonlar için geçerlidir.";
        $exit_tr_widget->features_text =
          "<ul><li>En İyi Fiyat ile Rezervasyon</li><li>Zamandan Tasarruf</li></ul>";
        $exit_tr_widget->reservation_button_text = "REZERVE ET";
        $exit_tr_widget->promotion_text = "İndirim Kodunuz";
        $exit_tr_widget->promotion_code = "LOVEISTANBUL";
        $exit_tr_widget->color = "#740202";

        $hotel->widgets()->save($exit_tr_widget);
      }

      if ($exit_en_widget == null) {
        $exit_en_widget = new Widget();
        $exit_en_widget->language_id = 2;
        $exit_en_widget->type = "exit";
        $exit_en_widget->code = $code;

        $exit_en_widget->is_active = 1;
        $exit_en_widget->main_title = "Hey, Don't Leave!";
        $exit_en_widget->explanation_text =
          "We have a special offer for you. Please use the below discount code to get your special rate for your accommodation in Istanbul. Only available for bookings made on our official website.";
        $exit_en_widget->features_text =
          "<ul><li>Best Rate Guaranteed</li><li>Free Breakfast</li><li>Free Wifi</li></ul>";
        $exit_en_widget->reservation_button_text = "Book Now";
        $exit_en_widget->promotion_text = "Discount Code";
        $exit_en_widget->promotion_code = "LOVEISTANBUL";
        $exit_en_widget->color = "#740202";

        $hotel->widgets()->save($exit_en_widget);
      }

      $excel->getActiveSheet()->SetCellValue('A' . $count, $name);
      $excel->getActiveSheet()->SetCellValue('B' . $count, $email);
      $excel->getActiveSheet()->SetCellValue('C' . $count, $websiteUrl);
      $excel->getActiveSheet()->SetCellValue('D' . $count, $password);
      $excel->getActiveSheet()->SetCellValue('E' . $count, $propertyName);
      $excel->getActiveSheet()->SetCellValue('F' . $count, $odamaxUrl);
      $excel->getActiveSheet()->SetCellValue('G' . $count, $otelzUrl);
      $excel->getActiveSheet()->SetCellValue('H' . $count, $ibeUrl);
      $excel
        ->getActiveSheet()
        ->SetCellValue(
          'I' . $count,
          "https://hoteldigilab.biz/widget/" . $main_tr_widget->code
        );
      $count++;
    }

    header('Content-type: application/vnd.ms-excel');

    header('Content-Disposition: attachment; filename="smallhotels.xls"');

    $objWriter = $objWriter = PHPExcel_IOFactory::createWriter(
      $excel,
      'Excel2007'
    );
    ob_end_clean();
    $objWriter->save('php://output');
  }

  public function otelzTest()
  {
    //        $json = "{\"Place\":{\"Id\":13369,\"Type\":0,\"Group\":6,\"CountryCode\":\"TR\",\"Latitude\":39.925533,\"Longitude\":32.866287},\"TotalRooms\":1,\"TotalAdult\":2,\"TotalChild\":0,\"StartDate\":\"2020-05-04\",\"EndDate\":\"2020-05-05\",\"Distance\":0,\"SearchType\":1,\"CityId\":0,\"Rooms\":[{\"Adult\":2,\"Children\":0,\"Ages\":[]}],\"RouteId\":0,\"Language\":\"tr\",\"Currency\":1,\"Device\":0,\"FacilityId\":13369}";

    $reqArray = [
      'Place' => [
        'Id' => 13369,
        'Type' => 0,
        'Group' => 6,
        'CountryCode' => 'TR',
        'Latitude' => 39.925533,
        'Longitude' => 32.866287,
      ],
      'TotalRooms' => 1,
      'TotalAdult' => 2,
      'TotalChild' => 0,
      'StartDate' => '2021-05-04',
      'EndDate' => '2021-05-05',
      'Distance' => 0,
      'SearchType' => 1,
      'CityId' => 0,
      'Rooms' => [
        [
          'Adult' => 2,
          'Children' => 0,
          'Ages' => [],
        ],
      ],
      'RouteId' => 0,
      'Language' => 'tr',
      'Currency' => 1,
      'Device' => 0,
      'FacilityId' => 13369,
    ];

    $json_data = json_encode($reqArray, JSON_UNESCAPED_SLASHES);

    //        dd($json_data);

    $ch = curl_init('https://www.otelz.com/rest/detail-price/tr');
    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $json_data);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
      'Content-Type: application/json;charset=utf-8',
      'Content-Length: ' . strlen($json_data),
      'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:84.0) Gecko/20100101 Firefox/84.0',
      'Origin: https://www.otelz.com',
      'Referer: https://www.otelz.com/',
      'Cookie: __cfduid=d636bc7f5317470fd494ee6087d5bc10f1611523137; oz-ctx=44bd7492-5b57-4abb-b7fd-e8211b7894ee; ss-pid=22D2kotVt4thjvKBfXHM; ss-id=qobENYojtTg0jmyhTUGw; ASP.NET_SessionId=38221f61-10b2-4087-93b3-2e380070307a; oz-vid=38221f61-10b2-4087-93b3-2e380070307aTE: Trailers',
    ]);

    $result = json_decode(curl_exec($ch));

    dd($result);
  }

  public function toArray()
  {
    $json =
      "{\"Place\":{\"Id\":14142,\"Type\":0,\"Group\":6,\"CountryCode\":\"TR\",\"Latitude\":39.925533,\"Longitude\":32.866287},\"TotalRooms\":1,\"TotalAdult\":2,\"TotalChild\":0,\"StartDate\":\"2020-06-26\",\"EndDate\":\"2020-06-27\",\"Distance\":0,\"SearchType\":1,\"CityId\":0,\"Rooms\":[{\"Adult\":2,\"Children\":0,\"Ages\":[]}],\"Language\":\"tr\",\"Currency\":1,\"Device\":0,\"FacilityId\":14142}";
    print json_decode($json);
  }

  public function reseller()
  {
    dd(
      user()
        ->reseller()
        ->get()
    );
  }

  public function assetLogo()
  {
    dd(public_path("logo"));
  }

  public function subUser()
  {
    dd(
      user()
        ->subUsers()
        ->get()
    );
  }

  public function jsParse()
  {
    $handle = fopen(asset("assets/test.js"), 'r');

    $result = "";

    while (!feof($handle)) {
      $result .= fgets($handle);
    }

    echo str_replace("{{ asd }}", "12341234", $result);
  }

  public function currencies()
  {
    dd(simplexml_load_file('http://www.tcmb.gov.tr/kurlar/today.xml'));
  }

  public function time()
  {
    dd(Carbon::now()->startOfYear());
  }

  public function flags()
  {
    $countries = Country::all();

    foreach ($countries as $country) {
      echo '<img src="' .
        asset("/assets/common/img/flags") .
        "/" .
        str_replace(" ", "-", $country['name']) .
        '.png">' .
        " " .
        str_replace(" ", "-", $country['name']) .
        "<br>";
    }
  }

  public function parseTatilSepetiPrice()
  {
    $search_url =
      "https://www.tatilsepeti.com/buyukada-princess-hotel?ara=oda:2;tarih:19.08.2020,20.08.2020;click:true";
    $html = getHTML($search_url, 10, 2);
    $html = str_replace(["\n", "\r", "\n"], ' ', $html);

    $currency_xml = simplexml_load_file(
      'http://www.tcmb.gov.tr/kurlar/today.xml'
    );
    $usdSelling = $currency_xml->Currency[0]->BanknoteSelling;
    $eurSelling = $currency_xml->Currency[3]->BanknoteSelling;

    //        dd($html);

    $tryPrice = search(
      '<span class="Prices--Price">',
      '<small class=\'price-currency\'>',
      $html
    );
    $tryPrice = str_replace(",", "", trim($tryPrice[0]));

    dd($tryPrice);

    dump(round($tryPrice / $eurSelling));
  }

  function parseOtelzPrice()
  {
    $params = json_encode(
      '{"Place":{"Id":4666,"Type":0,"Group":6,"CountryCode":"TR","Latitude":39.925533,"Longitude":32.866287},"TotalRooms":1,"TotalAdult":2,"TotalChild":0,"StartDate":"2020-03-12","EndDate":"2020-03-13","Distance":0,"SearchType":1,"CityId":0,"Rooms":[{"Adult":2,"Children":0,"Ages":[]}],"Language":"tr","Currency":1,"Device":0,"FacilityId":4666}'
    );

    $url = "https://www.otelz.com/rest/detail-price/tr";

    $header = [];
    $header[0] = "Accept: text/xml,application/xml,application/xhtml+xml,";
    $header[0] .= "text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5";
    $header[0] .= "Cache-Control: max-age=0";
    $header[] = "Connection: keep-alive";
    $header[] = "Keep-Alive: 300";
    $header[] = "Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7";
    $header[] = "Pragma: "; // browsers keep this blank.

    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_USERAGENT, $_SERVER['HTTP_USER_AGENT']); // set  useragent
    curl_setopt($ch, CURLOPT_HTTPHEADER, $header);
    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    curl_setopt($ch, CURLOPT_FRESH_CONNECT, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $params);
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_COOKIESESSION, true);
    curl_setopt($ch, CURLOPT_COOKIEJAR, realpath('/tmp/cookies.txt'));
    curl_setopt($ch, CURLOPT_COOKIEFILE, realpath('/tmp/cookies.txt'));

    $result = curl_exec($ch);

    curl_close($ch);

    echo $result;
  }

  public function parseOdamaxPrice()
  {
    $search_url =
      "https://www.odamax.com/tr/hotel/dias-hotel-136526?check_in=19.10.2020&check_out=20.10.2020&adult_1=2&currency=EUR";
    $html = getHTML($search_url, 10, 2);
    $html = str_replace(["\n", "\r", "\n"], ' ', $html);

    $tryPrice = search('<i class="integers ">', '</i>', $html);
    $tryPrice = str_replace(",", "", trim($tryPrice[0]));

    dd($tryPrice);

    ////        dd(getOdamaxPrice("136526", "TRY", "2019-06-15", '2019-06-16'));
    //
    //        $data = [
    //            'checkIn'                           => '2019-10-28',
    //            'checkOut'                          => '2019-10-29',
    //            'hotelId'                           => '276079',
    //            'hotelSourceType'                   => 'ODAMAX',
    //            'presentationId'                    => '276079',
    //            'hotelRateSummaryRoomParameterList' => [[
    //                'adultCount' => '2',
    //            ]],
    //            'userAgent'                         => 'Mozilla/5.0 (X11; Linux x86_64; rv:66.0) Gecko/20100101 Firefox/66.0',
    //            'currency'                          => 'EUR',
    //            'expediaId'                         => '',
    //            'withRoomDetails'                   => false,
    //        ];
    //
    //        $json_data = json_encode($data, JSON_UNESCAPED_SLASHES);
    //
    //        $ch = curl_init('https://www.odamax.com/tr/hotel/roomsWithPrice');
    //        curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    //        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    //        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
    //        curl_setopt($ch, CURLOPT_POSTFIELDS, $json_data);
    //        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
    //        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    //        curl_setopt($ch, CURLOPT_HTTPHEADER, [
    //                'Content-Type: application/json',
    //                'Content-Length: ' . strlen($json_data)]
    //        );
    //
    //        $result = json_decode(curl_exec($ch));
    //
    //        $price = $result->response->perfectMatchSummary->convertedDiscountedPrice ?: ($result->response->perfectMatchSummary->convertedPrice ?: ($result->response->perfectMatchSummary->totalDiscountedPrice ?: ""));
    //
    //
    //        dd($price);
    //
    //        dd(round($result->response->perfectMatchSummary->convertedPrice));
  }

  public function sabeeAvailabilityTest()
  {
    $sabeeApp = new SabeeClient(ENV("SABEE_API_KEY"));

    $parameters = [
      'hotel_id' => 7045,
      'start_date' => '2023-07-29',
      'end_date' => '2023-07-30',
      'rooms' => [
        ["room_id" => 22513, "rateplans" => [["rateplan_id" => 9179]]],
      ],
    ];

    $rate = $sabeeApp->request('booking/availability', $parameters, 'POST');

    dd($rate);
  }

  public function sabeePriceTest()
  {
    $sabeeApp = new SabeeClient(ENV("SABEE_API_KEY"));

    $parameters = [
      'hotel_id' => 1931,
      'start_date' => '2019-10-04',
      'end_date' => '2019-10-10',
      'rooms' => [
        ["room_id" => 22513, "rateplans" => [["rateplan_id" => 9179]]],
      ],
    ];

    $rate = $sabeeApp->request(
      'availabilityandrates/rate',
      $parameters,
      'POST'
    );

    dd($rate);
  }

  public function sabeeBookingAvailabilityTest()
  {
    $sabeeApp = new SabeeClient(ENV("SABEE_API_KEY"));

    $parameters = [
      'hotel_id' => 1026,
      'start_date' => '2019-07-04',
      'end_date' => '2019-07-05',
      'rooms' => [["room_id" => 8653, "guest_count" => ["adults" => 2]]],
    ];

    $response = $sabeeApp->request('booking/availability', $parameters, 'POST');

    //        dd($response);

    if ($response->success) {
      $available_rooms = $response->data->room_rates[0]->available_rooms;

      if ($available_rooms > 0) {
        $prices = $response->data->room_rates[0]->prices;

        $key = array_search(18316, array_column($prices, 'rateplan_id'));

        $price = $prices[$key]->amount;

        dd($price);
      } else {
        return "NA";
      }
    } else {
      return "NA";
    }
  }

  public function attributeTest()
  {
    $main_widget = Widget::all()
      ->where("code", "=", "yboqtr7ikmg")
      ->where("type", "=", "main")
      ->first();

    dd($main_widget->discount_type);
  }

  public function countryDetection()
  {
    $ip = $_SERVER['REMOTE_ADDR'];
    $c = Statistic::where('ip', $ip)
      ->select("country")
      ->first();

    $geoLoc = json_decode(
      file_get_contents("http://www.geoplugin.net/json.gp?ip=$ip")
    );

    dd($geoLoc);

    if ($c['country']) {
      return true;
    } else {
      return "false";
    }
  }

  public function parseBooking()
  {
    //        $html = getHTML("https://www.booking.com/hotel/tr/parna.html?selected_currency=EUR&checkin=2020-02-07&checkout=2020-02-08", 10);

    $url = "https://www.booking.com/hotel/gr/dias-alexandroupolis1.tr.html";
    $checkinDate = "2020-08-19";
    $checkoutDate = "2020-08-20";
    $currency = "EUR";

    $search_url =
      $url .
      "?selected_currency=" .
      $currency .
      "&checkin=" .
      $checkinDate .
      "&checkout=" .
      $checkoutDate .
      "";

    dd($search_url);

    $html = getHTML($search_url, 10);

    //        dd($html);

    echo $html;

    switch ($currency) {
      case "EUR":
        $currency_symbol = "€";
        break;
      case "USD":
        $currency_symbol = "US$";
        break;
      default:
        $currency_symbol = "TL";
    }

    $price = search('(' . $currency_symbol, ')', $html);

    dump($price);
  }

  public function getRates()
  {
    $start = microtime(true);

    $hotels = Hotel::all();

    foreach ($hotels as $hotel) {
      $booking_url = $hotel['booking_url'];
      $hotels_url = $hotel['hotels_url'];
      $tatilsepeti_url = $hotel['tatilsepeti_url'];
      $sabee_hotel_id = $hotel['sabee_hotel_id'];
      $sabee_room_id = $hotel['sabee_room_id'];
      $sabee_rateplan_id = $hotel['sabee_rateplan_id'];
      $odamax_url = $hotel['odamax_url'];

      $todayDate = Carbon::today()->toDateString();
      $tomorrowDate = Carbon::tomorrow()->toDateString();

      $booking_price = get_price(
        $booking_url,
        "TRY",
        $todayDate,
        $tomorrowDate
      );
      $sabee_price = getSabeePrice(
        $sabee_hotel_id,
        $sabee_room_id,
        $sabee_rateplan_id,
        "TRY",
        $todayDate,
        $tomorrowDate
      );
      $hotels_price = get_price($hotels_url, "TRY", $todayDate, $tomorrowDate);
      $tatilsepeti_price = getTatilSepetiPrice(
        $tatilsepeti_url,
        "TRY",
        $todayDate,
        $tomorrowDate
      );
      $odamax_price = getOdamaxPrice(
        $odamax_url,
        "TRY",
        $todayDate,
        $tomorrowDate
      );

      $rate = new Rate();

      $rate->hotel = $hotel['name'];
      $rate->sabee_price = (float) $sabee_price;
      $rate->booking_price = (float) $booking_price;
      $rate->hotels_price = (float) $hotels_price;
      $rate->tatilsepeti_price = (float) $tatilsepeti_price;
      $rate->odamax_price = (float) $odamax_price;

      $rate->save();

      dump(
        "sabee price : " .
          $sabee_price .
          "\n" .
          "booking price : " .
          $booking_price .
          "\n" .
          "hotels price : " .
          $hotels_price .
          "\n" .
          "tatilsepeti price : " .
          $tatilsepeti_price .
          "\n" .
          "odamax price : " .
          $odamax_price
      );
    }

    $stop = microtime(true);

    dd($stop - $start);
  }

  public function jsonDecode()
  {
    $r = json_decode(
      '{"type":["sabee","booking"],"hotelCode":"ny8anp0vfpo","currency":"EUR","startDate":"2019-12-15","endDate":"2019-12-16"}',
      true
    );

    dd($r["hotelCode"]);
  }

  public function testReseliva()
  {
    getReselivaPrice(
      "https://www.reseliva.com/booknow/AgvaGreenlineGuesthouse/",
      "USD",
      "13-03-2020",
      "14-03-2020"
    );
  }

  public function parseHotelsPrice()
  {
    $url = "hotels.com/ho463801";
    $currency = "USD";
    $checkinDate = "2020-02-11";
    $checkoutDate = "2020-02-12";

    $headers = [
      'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:74.0) Gecko/20100101 Firefox/74.0',
      'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
      'Accept-Language: en-US,en;q=0.5',
      'Accept-Encoding: gzip, deflate, br',
      'DNT: 1',
      'Connection: keep-alive',
    ];

    $search_url =
      "https://tr.hotels.com/ho227379/?currency=EUR&q-check-in=2020-03-26&q-check-out=2020-03-27";

    $ch = curl_init($search_url); // initialize curl with given url
    curl_setopt(
      $ch,
      CURLOPT_USERAGENT,
      "Mozilla/5.0 (Windows NT 10; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0"
    ); // set  useragent
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); // write the response to a variable
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); // follow redirects if any
    curl_setopt($ch, CURLOPT_ENCODING, "gzip");
    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 2); // max. seconds to execute
    curl_setopt($ch, CURLOPT_FAILONERROR, 1); // stop when it encounters an error
    curl_setopt($ch, CURLOPT_COOKIESESSION, true);
    curl_setopt($ch, CURLOPT_FRESH_CONNECT, true);
    $html = curl_exec($ch);

    $price = search('lowPrice" : ', ',', $html);
    if ($price != []) {
      return round(trim($price[0]));
    } else {
      return "";
    }
  }
}
